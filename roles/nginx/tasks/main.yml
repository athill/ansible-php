---
# nginx
- name: install nginx
  apt: name={{ item }} update_cache=yes state=latest force=yes
  with_items:
    - nginx
  become: yes

- name: uncomment server_names_hash_bucket_size  in nginx.conf
  replace:
    destfile: /etc/nginx/nginx.conf
    regexp: '^\s*#(\s*server_names_hash_bucket_size.*)$'
    replace: '\1'    
  become: yes

- name: delete sites-enabled/default
  file: 
      path: /etc/nginx/sites-enabled/default
      state: absent
  notify:
    - restart nginx
  become: yes

# create web directory
- name: create {{ web_dir }} directory
  file: dest={{ web_dir }} state=directory owner=www-data group=www-data mode=0775    
  become: yes

- name: chown/chmod {{ web_dir }}
  command: "{{ item }}"
  with_items:
    - chown {{ deploy_user_name }}:www-data {{ web_dir }}
    - chmod 775 {{ web_dir }}
  become: yes